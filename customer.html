<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Renault Nordic Friends&Family – Kundvy</title>
  <style>
    :root {
      --renault-black: #191c1f;
      --renault-yellow: #ffd200;
      --bg-dark: #050608;
      --card-bg: #12141a;
      --card-elevated: #181b22;
      --border-subtle: #2a2f3a;
      --text-main: #f5f7fa;
      --text-muted: #a4a9b6;
      --danger: #c62828;
      --success: #2e7d32;
      --shadow-soft: 0 18px 40px rgba(0, 0, 0, 0.45);
      --radius-lg: 18px;
      --radius-pill: 999px;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: "Renault Life", -apple-system, BlinkMacSystemFont,
        "Segoe UI", Arial, sans-serif;
      color: var(--text-main);
      background: radial-gradient(circle at top, #202430 0, #050608 45%, #000 100%);
      display: flex;
      justify-content: center;
      align-items: stretch;
    }

    a {
      color: inherit;
      text-decoration: none;
    }

    .page-wrapper {
      width: 100%;
      max-width: 1200px;
      padding: 32px 16px 40px;
      margin: 0 auto;
    }

    header.hero {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      align-items: flex-start;
      gap: 24px;
      margin-bottom: 24px;
    }

    .hero-left {
      display: flex;
      align-items: center;
      gap: 14px;
    }

    .hero-logo {
      width: 44px;
      height: 44px;
      border-radius: 14px;
      border: 1px solid rgba(255, 255, 255, 0.12);
      display: flex;
      align-items: center;
      justify-content: center;
      background: #000;
      overflow: hidden;
      box-shadow: 0 0 0 1px #000;
    }

    .hero-logo img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      display: block;
      background: #000;
    }

    .hero-branding-text {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .hero-branding-text span {
      text-transform: uppercase;
      font-size: 11px;
      letter-spacing: 0.16em;
      color: var(--text-muted);
    }

    .hero-branding-text strong {
      font-size: 13px;
      letter-spacing: 0.18em;
      text-transform: uppercase;
    }

    .hero-title-block {
      flex: 1;
      min-width: 260px;
    }

    .hero-title-block h1 {
      margin: 0 0 4px;
      font-size: clamp(24px, 3.6vw, 30px);
      letter-spacing: 0.18em;
      text-transform: uppercase;
    }

    .hero-title-block p {
      margin: 0;
      color: var(--text-muted);
      max-width: 520px;
      font-size: 14px;
    }

    .hero-pill {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 4px 10px;
      border-radius: var(--radius-pill);
      background: rgba(255, 210, 0, 0.08);
      border: 1px solid rgba(255, 210, 0, 0.35);
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.18em;
      margin-bottom: 8px;
    }

    .hero-pill-dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: var(--renault-yellow);
    }

    .hero-nav {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      font-size: 12px;
      color: var(--text-muted);
    }

    .hero-nav a {
      padding: 6px 12px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.16);
      background: rgba(0,0,0,0.35);
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.16em;
    }

    .hero-nav a:hover {
      background: rgba(255,255,255,0.05);
    }

    main {
      margin-top: 8px;
    }

    .card {
      background: radial-gradient(circle at top left, #232733 0, #12141a 45%, #0b0d11 100%);
      border-radius: var(--radius-lg);
      border: 1px solid rgba(255, 255, 255, 0.06);
      box-shadow: var(--shadow-soft);
      padding: 18px 18px 20px;
    }

    .vehicle-grid {
      display: grid;
      grid-template-columns: minmax(0, 1fr);
      gap: 16px;
      margin-top: 8px;
    }

    .vehicle-card {
      background: linear-gradient(145deg, var(--card-bg), var(--card-elevated));
      border-radius: 16px;
      border: 1px solid var(--border-subtle);
      overflow: hidden;
      display: flex;
      flex-direction: column;
      min-height: 100%;
    }

    .vehicle-media {
      position: relative;
      overflow: hidden;
    }

    .vehicle-media img {
      display: block;
      width: 100%;
      height: 220px;
      object-fit: cover;
      filter: saturate(1.05) contrast(1.05);
      transition: transform 0.22s ease;
    }

    .vehicle-card:hover .vehicle-media img {
      transform: scale(1.03);
    }

    .vehicle-media-tag {
      position: absolute;
      left: 12px;
      bottom: 12px;
      padding: 4px 10px;
      border-radius: 999px;
      background: rgba(0, 0, 0, 0.68);
      backdrop-filter: blur(6px);
      color: #f5f5f5;
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.16em;
    }

    .vehicle-body {
      padding: 14px 14px 14px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .vehicle-header {
      display: flex;
      justify-content: space-between;
      gap: 8px;
      align-items: flex-start;
    }

    .vehicle-title {
      font-size: 16px;
      margin: 0;
    }

    .vehicle-subtitle {
      margin: 2px 0 0;
      font-size: 12px;
      color: var(--text-muted);
    }

    .vehicle-price {
      margin-top: 4px;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .price-row {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      font-size: 13px;
    }

    .price-row--highlight {
      font-weight: 600;
    }

    .price-label {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.14em;
      color: var(--text-muted);
    }

    .price-value {
      font-size: 15px;
    }

    .vehicle-specs {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      font-size: 11px;
      color: var(--text-muted);
    }

    .vehicle-specs span {
      padding: 3px 9px;
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid rgba(255, 255, 255, 0.07);
    }

    .vehicle-timer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 4px;
      font-size: 11px;
      color: var(--text-muted);
    }

    .timer-label {
      opacity: 0.86;
    }

    .timer-value {
      padding: 3px 9px;
      border-radius: 999px;
      border: 1px solid var(--border-subtle);
      background: rgba(0, 0, 0, 0.45);
      font-size: 11px;
    }

    .customer-actions {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-top: 4px;
    }

    label {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.14em;
      color: var(--text-muted);
    }

    select {
      width: 100%;
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.18);
      background: rgba(8, 9, 12, 0.92);
      color: var(--text-main);
      font-size: 13px;
      outline: none;
    }

    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 9px 14px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      letter-spacing: 0.04em;
      text-transform: uppercase;
      transition: transform 0.12s ease, box-shadow 0.12s ease, background 0.15s ease,
        opacity 0.15s ease;
      white-space: nowrap;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--renault-yellow), #ffe55d);
      color: #151515;
      box-shadow: 0 14px 28px rgba(0, 0, 0, 0.6);
    }

    .btn-primary:hover {
      opacity: 0.92;
    }

    .btn-ghost {
      background: transparent;
      border: 1px solid rgba(255, 255, 255, 0.26);
      color: var(--text-main);
      font-size: 11px;
      padding-inline: 10px;
    }

    .btn-ghost:hover {
      background: rgba(255, 255, 255, 0.04);
    }

    .helper-text {
      margin: 4px 0 0;
      font-size: 11px;
      color: var(--text-muted);
    }

    footer {
      margin-top: 20px;
      font-size: 11px;
      color: var(--text-muted);
      text-align: left;
      opacity: 0.85;
    }

    /* Modal för köp/reservation */
    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 16px;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.2s ease;
      z-index: 1000;
    }

    .modal-backdrop.is-active {
      opacity: 1;
      pointer-events: auto;
    }

    .modal {
      width: 100%;
      max-width: 420px;
      background: radial-gradient(circle at top left, #232733 0, #12141a 45%, #0b0d11 100%);
      border-radius: 18px;
      border: 1px solid rgba(255, 255, 255, 0.12);
      box-shadow: var(--shadow-soft);
      padding: 18px 18px 16px;
      position: relative;
    }

    .modal h2 {
      margin: 0 0 6px;
      font-size: 18px;
    }

    .modal .helper-text {
      margin-top: 2px;
      margin-bottom: 10px;
    }

    .modal-form {
      display: grid;
      gap: 10px;
      margin-top: 6px;
    }

    .modal-close {
      position: absolute;
      top: 8px;
      right: 10px;
      border: none;
      background: transparent;
      color: var(--text-muted);
      font-size: 20px;
      cursor: pointer;
    }

    .modal input[type="text"],
    .modal input[type="tel"] {
      width: 100%;
      padding: 8px 10px;
      border-radius: 10px;
      border: 1px solid rgba(255, 255, 255, 0.16);
      background: rgba(10, 11, 14, 0.9);
      color: var(--text-main);
      font-size: 14px;
      outline: none;
      transition: border-color 0.16s ease, box-shadow 0.16s ease, background 0.16s ease;
    }

    .modal input[type="text"]:focus,
    .modal input[type="tel"]:focus {
      border-color: var(--renault-yellow);
      box-shadow: 0 0 0 1px rgba(255, 210, 0, 0.4);
      background: #14161d;
    }

    .checkbox-label {
      display: flex;
      align-items: flex-start;
      gap: 8px;
      font-size: 11px;
      color: var(--text-muted);
      line-height: 1.4;
    }

    .checkbox-label input[type="checkbox"] {
      margin-top: 2px;
    }

    .modal-actions {
      display: flex;
      flex-wrap: wrap;
      justify-content: flex-end;
      gap: 8px;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <div class="page-wrapper">
    <header class="hero">
      <div class="hero-left">
        <div class="hero-logo">
          <img
            src="https://static.vecteezy.com/ti/gratis-vektor/p1/20500058-renault-varumarke-logotyp-bil-symbol-med-namn-gul-design-franska-bil-vektor-illustration-med-svart-bakgrund-gratis-vector.jpg"
            alt="Renault-logotyp"
          />
        </div>
        <div class="hero-branding-text">
          <span>Rn Nordic Ab</span>
          <strong>Renault Nordic</strong>
        </div>
      </div>
      <div class="hero-title-block">
        <div class="hero-pill">
          <span class="hero-pill-dot"></span>
          <span>Friends&Family – Kundvy</span>
        </div>
        <h1>Utvalda bilar</h1>
        <p>
          Välkommen till Friends&Family. Här ser du särskilda erbjudanden för dig som är
          nära ansluten till RN Nordic – med lägre priser än ute i bilhandeln på utvalda bilar.
        </p>
      </div>
      <nav class="hero-nav">
        <a href="index.html">Friends&Family start</a>
        <a href="admin.html">Admin</a>
      </nav>
    </header>

    <main>
      <section class="card" aria-label="Tillgängliga bilar">
        <h2 style="margin:0 0 4px;font-size:16px;">Tillgängliga fordon</h2>
        <p class="helper-text">
          <strong>Välkommen till Friends&Family.</strong><br />
          Erbjudandena nedan riktar sig till dig som är nära ansluten till RN Nordic.<br /><br />
          Lägre priser än ute i bilhandeln. Specifika bilar som kan försvinna snabbt.
          Du reserverar bilen här, och fullföljer sedan affären hos den återförsäljare du valt.
          Om inget specifikt framgår av erbjudandet på denna sida kan du ordna finansiering
          tillsammans med återförsäljaren.
        </p>

        <div class="vehicle-grid">
          <!-- Bil 1 -->
          <article class="vehicle-card"
            data-car-name="Megane E-Tech Electric EV60"
            data-list-price="529 900 kr"
            data-ff-price="499 900 kr"
            data-days-left="5">
            <div class="vehicle-media">
              <img
                src="https://pro.bbcdn.io/ed/eda383b8-39a4-4b1f-bb67-9e52361f13c2?rule=news-large"
                alt="Renault Megane E-Tech – bild"
              />
              <div class="vehicle-media-tag">Elbil • Friends&Family</div>
            </div>
            <div class="vehicle-body">
              <div class="vehicle-header">
                <div>
                  <h3 class="vehicle-title">Megane E-Tech Electric EV60</h3>
                  <p class="vehicle-subtitle">Stockholm • Salonbil hos RN Nordic</p>
                </div>
              </div>

              <div class="vehicle-price">
                <div class="price-row">
                  <span class="price-label">Listpris</span>
                  <span class="price-value">529 900 kr</span>
                </div>
                <div class="price-row price-row--highlight">
                  <span class="price-label">För dig</span>
                  <span class="price-value">499 900 kr</span>
                </div>
              </div>

              <div class="vehicle-specs">
                <span>EV60 • 220 hk</span>
                <span>Long Range</span>
                <span>Pearl White</span>
              </div>

              <div class="vehicle-timer">
                <span class="timer-label">Erbjudandet gäller i:</span>
                <span class="timer-value"></span>
              </div>

              <div class="customer-actions">
                <div>
                  <label for="dealer-megane">Återförsäljare</label>
                  <select id="dealer-megane" class="dealer-select">
                    <option value="">Välj återförsäljare</option>
                    <option value="Hedin Bil Stockholm">Hedin Bil Stockholm</option>
                    <option value="Bilia Segeltorp">Bilia Segeltorp</option>
                    <option value="Brandt Bil Vänersborg">Brandt Bil Vänersborg</option>
                  </select>
                </div>
                <button class="btn btn-primary purchase-btn" type="button">
                  Köp / reservera
                </button>
                <p class="helper-text">
                  Välj återförsäljare och klicka på <strong>Köp / reservera</strong> för att fylla i dina uppgifter.
                </p>
              </div>
            </div>
          </article>

          <!-- Bil 2 -->
          <article class="vehicle-card"
            data-car-name="Austral E-Tech Full Hybrid"
            data-list-price="439 900 kr"
            data-ff-price="414 900 kr"
            data-days-left="3">
            <div class="vehicle-media">
              <img
                src="https://www.brandtbil.se/wp-content/uploads/renault-austral-2024-brandt-bil-1170x658.jpg.webp"
                alt="Renault Austral E-Tech – bild"
              />
              <div class="vehicle-media-tag">Hybrid • Friends&Family</div>
            </div>
            <div class="vehicle-body">
              <div class="vehicle-header">
                <div>
                  <h3 class="vehicle-title">Austral E-Tech Full Hybrid</h3>
                  <p class="vehicle-subtitle">Göteborg • Hedin Mobility Group</p>
                </div>
              </div>

              <div class="vehicle-price">
                <div class="price-row">
                  <span class="price-label">Listpris</span>
                  <span class="price-value">439 900 kr</span>
                </div>
                <div class="price-row price-row--highlight">
                  <span class="price-label">För dig</span>
                  <span class="price-value">414 900 kr</span>
                </div>
              </div>

              <div class="vehicle-specs">
                <span>Full Hybrid</span>
                <span>4Control Advanced</span>
                <span>Black Pearl</span>
              </div>

              <div class="vehicle-timer">
                <span class="timer-label">Erbjudandet gäller i:</span>
                <span class="timer-value"></span>
              </div>

              <div class="customer-actions">
                <div>
                  <label for="dealer-austral">Återförsäljare</label>
                  <select id="dealer-austral" class="dealer-select">
                    <option value="">Välj återförsäljare</option>
                    <option value="Hedin Bil Göteborg Mölndal">Hedin Bil Göteborg Mölndal</option>
                    <option value="Bilia Sisjön">Bilia Sisjön</option>
                    <option value="Brandt Bil Uddevalla">Brandt Bil Uddevalla</option>
                  </select>
                </div>
                <button class="btn btn-primary purchase-btn" type="button">
                  Köp / reservera
                </button>
                <p class="helper-text">
                  I nästa steg anger du dina uppgifter så att vald återförsäljare kan återkomma med offert och leveransförslag.
                </p>
              </div>
            </div>
          </article>

          <!-- Bil 3 -->
          <article class="vehicle-card"
            data-car-name="Arkana E-Tech Hybrid"
            data-list-price="389 900 kr"
            data-ff-price="369 900 kr"
            data-days-left="7">
            <div class="vehicle-media">
              <img
                src="https://cdn.wayke.se/cfit/54463ca0-e476-4864-bae0-c914b4eac342/c63cda6f-14e2-448f-96a6-cd3f2b2c654a?format=jpeg&r=0000000&w=1170"
                alt="Renault Arkana E-Tech – bild"
              />
              <div class="vehicle-media-tag">E-Tech • Begränsat antal</div>
            </div>
            <div class="vehicle-body">
              <div class="vehicle-header">
                <div>
                  <h3 class="vehicle-title">Arkana E-Tech Hybrid</h3>
                  <p class="vehicle-subtitle">Malmö • Privat kundkväll</p>
                </div>
              </div>

              <div class="vehicle-price">
                <div class="price-row">
                  <span class="price-label">Listpris</span>
                  <span class="price-value">389 900 kr</span>
                </div>
                <div class="price-row price-row--highlight">
                  <span class="price-label">För dig</span>
                  <span class="price-value">369 900 kr</span>
                </div>
              </div>

              <div class="vehicle-specs">
                <span>E-Tech Hybrid</span>
                <span>Monaco Blue</span>
                <span>18&quot; fälgar</span>
              </div>

              <div class="vehicle-timer">
                <span class="timer-label">Erbjudandet gäller i:</span>
                <span class="timer-value"></span>
              </div>

              <div class="customer-actions">
                <div>
                  <label for="dealer-arkana">Återförsäljare</label>
                  <select id="dealer-arkana" class="dealer-select">
                    <option value="">Välj återförsäljare</option>
                    <option value="Hedin Bil Malmö">Hedin Bil Malmö</option>
                    <option value="Bilia Lund">Bilia Lund</option>
                    <option value="Brandt Bil Kristianstad">Brandt Bil Kristianstad</option>
                  </select>
                </div>
                <button class="btn btn-primary purchase-btn" type="button">
                  Köp / reservera
                </button>
                <p class="helper-text">
                  Reservationen här är inte bindande – ansvarig säljare återkommer till dig innan affären slutförs hos återförsäljaren.
                </p>
              </div>
            </div>
          </article>
        </div>
      </section>
    </main>

    <footer>
      © 2025 RN Nordic AB – Renault Nordic Friends&Family. Prisuppgifter är indikativa
      och kan justeras av vald återförsäljare.
    </footer>
  </div>

  <!-- Popup för köp/reservation -->
  <div class="modal-backdrop" id="purchaseModal" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="purchaseModalTitle">
      <button type="button" class="modal-close" id="modalCloseBtn" aria-label="Stäng">&times;</button>
      <h2 id="purchaseModalTitle">Bekräfta reservation</h2>
      <p class="helper-text">
        Du reserverar <strong><span id="modalCarName"></span></strong> hos
        <strong><span id="modalDealerName"></span></strong>.
      </p>
      <p class="helper-text" id="modalPriceInfo" style="margin-top:0;"></p>

      <form class="modal-form" id="purchaseForm">
        <div>
          <label for="customerName">Namn</label>
          <input type="text" id="customerName" autocomplete="name" required />
        </div>
        <div>
          <label for="customerAddress">Adress</label>
          <input type="text" id="customerAddress" autocomplete="street-address" required />
        </div>
        <div>
          <label for="customerPhone">Telefonnummer</label>
          <input type="tel" id="customerPhone" autocomplete="tel" required />
        </div>

        <label class="checkbox-label">
          <input type="checkbox" id="consentCheckbox" />
          <span>
            Jag godkänner att vald återförsäljare och RN Nordic hanterar mina personuppgifter
            i samband med detta erbjudande, enligt gällande integritetspolicy.
          </span>
        </label>

        <div class="modal-actions">
          <button type="button" class="btn btn-ghost" id="cancelPurchaseBtn">Avbryt</button>
          <button type="button" class="btn btn-primary" id="confirmPurchaseBtn">Skicka förfrågan</button>
        </div>
      </form>
    </div>
  </div>

  <script>
    (function () {
      // Enkel directory för demo – byt till riktiga adresser i produktion
      const dealerEmailDirectory = {
        "Hedin Bil Stockholm": "hedin.stockholm@example.com",
        "Bilia Segeltorp": "bilia.segeltorp@example.com",
        "Brandt Bil Vänersborg": "brandt.vanersborg@example.com",
        "Hedin Bil Göteborg Mölndal": "hedin.goteborg@example.com",
        "Bilia Sisjön": "bilia.sisjon@example.com",
        "Brandt Bil Uddevalla": "brandt.uddevalla@example.com",
        "Hedin Bil Malmö": "hedin.malmo@example.com",
        "Bilia Lund": "bilia.lund@example.com",
        "Brandt Bil Kristianstad": "brandt.kristianstad@example.com"
      };

      // Mottagare hos RN Nordic (demo)
      const rnRecipients = ["friendsfamily-demo@rn-nordic.se"];

      const modalBackdrop = document.getElementById("purchaseModal");
      const modalCloseBtn = document.getElementById("modalCloseBtn");
      const confirmBtn = document.getElementById("confirmPurchaseBtn");
      const cancelBtn = document.getElementById("cancelPurchaseBtn");
      const nameInput = document.getElementById("customerName");
      const addressInput = document.getElementById("customerAddress");
      const phoneInput = document.getElementById("customerPhone");
      const consentCheckbox = document.getElementById("consentCheckbox");
      const modalCarName = document.getElementById("modalCarName");
      const modalDealerName = document.getElementById("modalDealerName");
      const modalPriceInfo = document.getElementById("modalPriceInfo");

      let activeContext = null;

      function openModal(context) {
        activeContext = context;
        modalCarName.textContent = context.carName;
        modalDealerName.textContent = context.dealer;
        modalPriceInfo.textContent =
          "Listpris " + (context.listPrice || "-") +
          " • För dig " + (context.ffPrice || "-");

        nameInput.value = "";
        addressInput.value = "";
        phoneInput.value = "";
        consentCheckbox.checked = false;

        modalBackdrop.classList.add("is-active");
        nameInput.focus();
      }

      function closeModal() {
        modalBackdrop.classList.remove("is-active");
        activeContext = null;
      }

      if (modalCloseBtn) {
        modalCloseBtn.addEventListener("click", closeModal);
      }
      if (cancelBtn) {
        cancelBtn.addEventListener("click", closeModal);
      }
      if (modalBackdrop) {
        modalBackdrop.addEventListener("click", (event) => {
          if (event.target === modalBackdrop) {
            closeModal();
          }
        });
      }
      document.addEventListener("keydown", (event) => {
        if (event.key === "Escape" && modalBackdrop.classList.contains("is-active")) {
          closeModal();
        }
      });

      // Köp/reservera-knappar
      document.querySelectorAll(".vehicle-card").forEach((card) => {
        const btn = card.querySelector(".purchase-btn");
        const select = card.querySelector(".dealer-select");
        const carName = card.getAttribute("data-car-name");
        const listPrice = card.getAttribute("data-list-price");
        const ffPrice = card.getAttribute("data-ff-price");
        const daysLeft = card.getAttribute("data-days-left");
        const timerEl = card.querySelector(".timer-value");

        if (timerEl && daysLeft) {
          timerEl.textContent = daysLeft + " dagar kvar";
        }

        if (!btn || !select) return;

        btn.addEventListener("click", () => {
          const dealer = select.value;
          if (!dealer) {
            alert("Välj återförsäljare innan du reserverar bilen.");
            return;
          }

          openModal({ carName, listPrice, ffPrice, dealer });
        });
      });

      if (confirmBtn) {
        confirmBtn.addEventListener("click", () => {
          if (!activeContext) return;

          const name = nameInput.value.trim();
          const address = addressInput.value.trim();
          const phone = phoneInput.value.trim();

          if (!name || !address || !phone) {
            alert("Fyll i namn, adress och telefonnummer.");
            return;
          }

          if (!consentCheckbox.checked) {
            alert("Du behöver godkänna hanteringen av dina personuppgifter.");
            return;
          }

          const dealerEmail =
            dealerEmailDirectory[activeContext.dealer] ||
            "friendsfamily-demo@rn-nordic.se";

          const recipients = [dealerEmail].concat(rnRecipients);

          const subject = "Friends&Family – reservation " + activeContext.carName;
          const bodyLines = [
            "Förfrågan från Friends&Family-portalen",
            "",
            "Bil: " + activeContext.carName,
            "Listpris: " + (activeContext.listPrice || "-"),
            "Friends&Family-pris: " + (activeContext.ffPrice || "-"),
            "Återförsäljare: " + activeContext.dealer,
            "",
            "Kunduppgifter:",
            "Namn: " + name,
            "Adress: " + address,
            "Telefon: " + phone,
            "",
            "Kunden har godkänt att vald återförsäljare och RN Nordic hanterar personuppgifterna i samband med detta erbjudande.",
            "",
            "---",
            "Detta e-postmeddelande är genererat via Friends&Family-sidan (demo)."
          ];

          const mailtoUrl =
            "mailto:" +
            encodeURIComponent(recipients.join(",")) +
            "?subject=" +
            encodeURIComponent(subject) +
            "&body=" +
            encodeURIComponent(bodyLines.join("\n"));

          window.location.href = mailtoUrl;

          closeModal();
          alert("Vi har skapat ett e‑postutkast till vald återförsäljare och RN Nordic.");
        });
      }
    })();
  </script>
</body>
</html>
